@using App.Domain.Core.Dtos.ProposalAgg
@using App.Domain.Core.Enums.ProposalAgg
@model List<ExpertProposalDto>

@{
    ViewData["Title"] = "لیست پیشنهادهای من";
}

<div class="container py-5" dir="rtl">
    <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
        <h4 class="fw-bold text-primary">
            <i class="bi bi-mailbox2 ms-2"></i>تاریخچه پیشنهادهای ارسال شده
        </h4>
        <a asp-area="Expert" asp-controller="Order" asp-action="Index" class="btn btn-outline-success rounded-pill btn-sm">
            <i class="bi bi-search me-1"></i> مشاهده کارهای جدید
        </a>
    </div>

    @if (!Model.Any())
    {
        <div class="alert alert-light text-center py-5 shadow-sm rounded-4 border-0">
            <i class="bi bi-chat-left-dots fs-1 text-muted d-block mb-3"></i>
            <p class="text-muted">شما هنوز هیچ پیشنهادی ثبت نکرده‌اید.</p>
        </div>
    }
    else
    {
        <div class="table-responsive shadow-sm rounded-4 overflow-hidden">
            <table class="table table-hover align-middle bg-white mb-0">
                <thead class="table-light">
                    <tr class="text-secondary text-center">
                        <th class="py-3 text-start ps-4">سرویس / مشتری</th>
                        <th>قیمت (ریال)</th>
                        <th>تاریخ و ساعت</th>
                        <th style="width: 25%;">توضیحات شما</th> @* ستون جدید *@
                        <th>وضعیت</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr class="text-center">
                            <td class="text-start ps-4">
                                <div class="fw-bold text-dark">@item.HomeServiceName</div>
                                <div class="small text-muted">مشتری: @item.CustomerFullName</div>
                            </td>
                            <td class="text-success fw-bold">
                                @item.Price.ToString("N0")
                            </td>
                            <td>
                                <div class="small fw-bold">@item.PersianExecutionDate</div>
                                <div class="text-muted small">@item.ExecutionTime.ToString(@"hh\:mm")</div>
                            </td>
                            <td class="text-start">
                                @* نمایش ساده توضیحات با فونت ریزتر و محدودیت نمایش *@
                                <p class="small text-secondary mb-0" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; line-height: 1.6;">
                                    @item.Description
                                </p>
                            </td>
                            <td>
                                <span class="badge @GetStatusClass(item.Status) rounded-pill px-3 py-2">
                                    @GetStatusName(item.Status)
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

@section Scripts {
    <script src="~/js/date-converter.js"></script>
}

@functions {
    string GetStatusName(ProposalStatus status) => status switch
    {
        ProposalStatus.Pending => "در انتظار تایید",
        ProposalStatus.Accepted => "تایید شده توسط مشتری",
        ProposalStatus.Rejected => "رد شده",
        ProposalStatus.OrderCancelled => "سفارش لغو شده است",
        _ => "نامشخص"
    };

    string GetStatusClass(ProposalStatus status) => status switch
    {
        ProposalStatus.Pending => "bg-warning text-dark",
        ProposalStatus.Accepted => "bg-success",
        ProposalStatus.Rejected => "bg-danger",
        _ => "bg-secondary"
    };
}